{% extends "temple_auth/new_base.html" %}
{% load static %}

{% block custom-style %}
@media (max-width: 767.98px) {
    .table thead {
        display: none;
    }
    .table tbody, .table tr, .table td {
        display: block;
        width: 100%;
    }
    .table tr {
        margin-bottom: 10px;
    }
    .table td {
        text-align: right;
        position: relative;
        padding-left: 50%;
    }
    .table td::before {
        content: attr(data-label);
        position: absolute;
        left: 0;
        width: 50%;
        padding-left: 15px;
        font-weight: bold;
        text-align: left;
    }
    .table td input,
    .table td select {
        width: 100%;
    }
}






/* General Card Styling */
.card {
    border-radius: 12px;
    background-color: #ffffff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Card Title */
.card-title {
    color: #333;
    font-size: 1.5rem;
    font-weight: 600;
    letter-spacing: 1px;
}

/* Form Controls */
.form-select, .form-control {
    border-radius: 10px;
    padding: 0.75rem 1.25rem;
    font-size: 1rem;
    border: 1px solid #ddd;
    background-color: #fafafa;
    transition: all 0.3s ease-in-out;
}

/* Focus Effects */
.form-select:focus, .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
    background-color: #fff;
}

/* Gap Amount Container */
#gap-amount-container input {
    font-size: 1rem;
    border-radius: 10px;
    padding: 0.75rem 1.25rem;
    border: 1px solid #ddd;
    background-color: #fafafa;
}

#gap-amount-container input:focus {
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
}

/* Responsive Design for Smaller Screens */
@media (max-width: 576px) {
    .form-select, .form-control {
        font-size: 0.9rem;
        padding: 0.65rem 1rem;
    }
    
    .card-body {
        padding: 1.5rem;
    }
}

/* Adjust Card Padding and Shadow */
.card-body {
    padding: 2rem;
}

.card {
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
}
{% endblock %}

{% block main-content %}
<main id="main" class="main">
    <div class="pagetitle">
        <h1>Tabs</h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
                <li class="breadcrumb-item active">Billing</li>
            </ol>
        </nav>
    </div><!-- End Page Title -->

    <section class="section">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <ul class="nav nav-tabs nav-tabs-bordered d-flex" id="borderedTabJustified" role="tablist">
                            <li class="nav-item flex-fill" role="presentation">
                                <button class="nav-link w-100 active" id="home-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-home" type="button" role="tab" aria-controls="home" aria-selected="true">വഴിപാട്‌ ബുക്കിംഗ്</button>
                            </li>

                        </ul>
                        <div class="tab-content pt-2" id="borderedTabJustifiedContent">
                            <div class="tab-pane fade show active" id="bordered-justified-home" role="tabpanel" aria-labelledby="home-tab">
                                <form class="row g-3" id="billing-form" action="{% url 'submit-billing' %}" method="POST">
                                  {% csrf_token %}
                                    <!-- Billing Basic Details -->
                                    <!-- Vazhipadu Details -->
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">വഴിപാട് വിശദാംശങ്ങൾ</h5>

                                            
                                            <div class="container" id="vazhipadu-form-container">

                                                <div class="row" id="vazhipadu-form-row">
                                                    <div class="col-12 col-sm-2 text-center p-3">
                                                        <input type="text" name="name[]" class="form-control" placeholder="പേര്" required>
                                                    </div>
                                                    <div class="col-12 col-sm-2 text-center p-3">
                                                        <select name="nakshatram[]" class="form-control" required>
                                                            <option value="" disabled selected>നക്ഷത്രം</option>
                                                            {% for star in star_items %}
                                                            <option value="{{ star.name }}">{{star.id}}: {{ star.name }}</option>
                                                            {% endfor %}
                                                        </select>    
                                                    </div>
                                                    <div class="col-12 col-sm-2 text-center p-3">
                                                        <select name="pooja[]" class="form-control pooja-select" id="pooja-select" onchange="updateStaticPoojaPrice()" required>
                                                            <option value="" disabled selected>വഴിപാട്</option>
                                                            {% for vazhipadu in vazhipadu_items %}
                                                            <option value="{{ vazhipadu.name }}" data-price="{{ vazhipadu.price }}">{{vazhipadu.order}} - {{ vazhipadu.name }} - ({{ vazhipadu.price }})</option>
                                                            {% endfor %}
                                                        </select>    
                                                    </div>
                                                    <div class="col-12 col-sm-2 text-center p-3">
                                                        <input type="number" name="pooja_price[]" class="form-control pooja-price" id="pooja-price" placeholder="വില" readonly>
                                                    </div>
                                                    <div class="col-12 col-sm-2 text-center p-3">
                                                       <button type="button" class="btn btn-danger remove-row" style="height: 42px; font-size: 20px; border-radius: 50%; justify-content: center; align-items: center;">X</button> 
                                                    </div>
                                                </div>


                                            </div>
                            

                                            <div class="text-center mt-3">
                                                <button type="button" class="btn btn-outline-success" id="add-vazhipadu-row">Add +</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Things Details -->
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">Other</h5>

                                            <div class="container" id="things-form-container">
                                            </div>

                                            <div class="text-center">
                                                <button type="button" class="btn btn-outline-success" id="add-things-row">Add +</button>
                                            </div>
                                        </div>
                                    </div>





<!-- Payment Method Section -->
<div class="card shadow-lg rounded-lg border-0 mb-4">
    <div class="card-body">
        <h5 class="card-title text-center mb-4" style="font-size: 1.5rem; font-weight: 600;">Payment Method</h5>
        <div class="row">
            <!-- Payment Method Dropdown -->
            <div class="col-12 col-sm-6 col-md-4 mb-3">
                <label for="payment-method" class="form-label fw-bold">Select Payment Method</label>
                <select name="payment_method" id="payment-method" class="form-select" required>
                    <option value="" disabled selected>Select Payment Method</option>
                    <option value="Cash">Cash</option>
                    <option value="Online">Online</option>
                    <option value="Both">Both</option>
                </select>
            </div>
            <!-- Gap Amount Field -->
            <div class="col-12 col-sm-6 col-md-4 mb-3 d-none" id="gap-amount-container">
                <label for="gap-amount" class="form-label fw-bold">Enter Gap Amount</label>
                <input type="number" name="gap_amount" id="gap-amount" class="form-control" placeholder="Enter Gap Amount">
            </div>
        </div>
    </div>
</div>


                                    <div class="text-center">
                                        <button type="button" class="btn btn-primary" id="submit-button">Submit & Print</button>
                                    </div>
                                </form>
                            </div>
                        </div><!-- End Bordered Tabs Justified -->
                    </div>
                </div>
            </div>
        </div>
    </section>
</main><!-- End #main -->


  <script src="assets/vendor/quill/quill.js"></script>
  <script src="{% static 'assets/js/simple-datatables.js' %}"></script>

{% endblock %}


  {% block main-script %}
  <script>
document.addEventListener('DOMContentLoaded', function () {


    const billingForm = document.getElementById('billing-form');
    const submitButton = document.getElementById('submit-button');



    const paymentMethodSelect = document.getElementById('payment-method');
    // const gapAmountContainer = document.getElementById('gap-amount-container');
    const gapAmountInput = document.getElementById('gap-amount');

    // Show/Hide Gap Amount based on Payment Method
    paymentMethodSelect.addEventListener('change', function () {
        if (this.value === 'Both') {
            gapAmountContainer.classList.remove('d-none');
            gapAmountInput.setAttribute('required', 'required');
        } else {
            gapAmountContainer.classList.add('d-none');
            gapAmountInput.removeAttribute('required');
            gapAmountInput.value = '';  // Reset gap amount when not required
        }
    });

    // Optional: Enable/Disable Submit Button based on form validity
    billingForm.addEventListener('input', function () {
        // Check if the form is valid (all required fields are filled)
        if (billingForm.checkValidity()) {
            submitButton.disabled = false;  // Enable submit button
        } else {
            submitButton.disabled = true;   // Disable submit button if form is invalid
        }
    });
        





    // Disable the submit button initially
    submitButton.disabled = true;

    // Function to check if all fields are filled
    function validateForm() {
        let isValid = true;

        // Check all inputs and selects within the form
        billingForm.querySelectorAll('input[required], select[required]').forEach(function (field) {
            if (!field.value.trim()) {
                isValid = false;
            }
        });

        // Enable or disable the submit button based on the validity
        submitButton.disabled = !isValid;
    }

    // Add event listeners to all input and select fields
    billingForm.addEventListener('input', validateForm);

    // Add Vazhipadu row
    document.getElementById('add-vazhipadu-row').addEventListener('click', function () {
        const containerBody = document.getElementById('vazhipadu-form-container');

        const newRow = document.createElement('div');
        newRow.classList.add('row', 'vazhipadu-form-row');
        newRow.innerHTML = `
            <div class="col-12 col-sm-2 text-center p-3">
                <input type="text" name="name[]" class="form-control" placeholder="പേര്" required>
            </div>
            <div class="col-12 col-sm-2 text-center p-3">
                <select name="nakshatram[]" class="form-control" required>
                    <option value="" disabled selected>നക്ഷത്രം</option>
                    {% for star in star_items %}
                    <option value="{{ star.name }}">{{star.id}}: {{ star.name }}</option>
                    {% endfor %}
                </select>    
            </div>
            <div class="col-12 col-sm-2 text-center p-3">
                <select name="pooja[]" class="form-control pooja-select" required>
                    <option value="" disabled selected>വഴിപാട്</option>
                    {% for vazhipadu in vazhipadu_items %}
                    <option value="{{ vazhipadu.name }}" data-price="{{ vazhipadu.price }}">{{vazhipadu.order}} - {{ vazhipadu.name }} - ({{ vazhipadu.price }})</option>
                    {% endfor %}
                </select>    
            </div>
            <div class="col-12 col-sm-2 text-center p-3">
                <input type="number" name="pooja_price[]" class="form-control pooja-price" placeholder="വില" readonly>
            </div>
            <div class="col-12 col-sm-2 text-center p-3">
                <button type="button" class="btn btn-danger remove-row" style="height: 42px; font-size: 20px; border-radius: 50%; justify-content: center; align-items: center;">X</button>
            </div>
        `;
        containerBody.appendChild(newRow);

        // Add event listener for validation on new inputs and selects
        newRow.querySelectorAll('input[required], select[required]').forEach(function (field) {
            field.addEventListener('input', validateForm);
        });

        // Add event listener for updating price based on selected pooja
        newRow.querySelector('.pooja-select').addEventListener('change', function () {
            const selectedOption = this.options[this.selectedIndex];
            const price = selectedOption.getAttribute('data-price');
            newRow.querySelector('.pooja-price').value = price || '';
        });

        validateForm(); // Revalidate the form after adding a row
    });

    // Remove row event listener (shared for both Vazhipadu and Things)
    document.addEventListener('click', function (event) {
        if (event.target.classList.contains('remove-row')) {
            event.target.closest('.row').remove();
            validateForm(); // Revalidate the form after removing a row
        }
    });

    // Add event listeners for the "Add Things" button and fields
    document.getElementById('add-things-row').addEventListener('click', function () {
        const containerBody = document.getElementById('things-form-container');

        const newRow = document.createElement('div');
        newRow.classList.add('row', 'things-form-row');
        newRow.innerHTML = `
            <div class="col-12 col-sm-2 text-center p-3">
                <input type="text" name="other_name[]" class="form-control" placeholder="പേര്" required>
            </div>
            <div class="col-12 col-sm-2 text-center p-3">
                <select name="other_nakshatram[]" class="form-control" required>
                    <option value="" disabled selected>നക്ഷത്രം</option>
                    {% for star in star_items %}
                    <option value="{{ star.name }}">{{star.id}}: {{ star.name }}</option>
                    {% endfor %}
                </select>  
            </div>
            <div class="col-12 col-sm-2 text-center p-3">
                <input type="text" name="other_vazhipadu[]" class="form-control" placeholder="വഴിപാട്" required>
            </div>
            <div class="col-12 col-sm-2 text-center p-3">
                <input type="number" name="other_price[]" class="form-control thing-price" placeholder="വില" required>
            </div>
            <div class="col-12 col-sm-2 text-center p-3">
                <button type="button" class="btn btn-danger remove-row" style="height: 42px; font-size: 20px; border-radius: 50%; justify-content: center; align-items: center;">X</button>
            </div>
        `;
        containerBody.appendChild(newRow);

        // Add event listener for validation on new inputs and selects
        newRow.querySelectorAll('input[required], select[required]').forEach(function (field) {
            field.addEventListener('input', validateForm);
        });

        validateForm(); // Revalidate the form after adding a row
    });

    validateForm(); // Initial validation
});


    
    // Submit form programmatically on "Submit" button click
    document.getElementById('submit-button').addEventListener('click', function() {
        document.getElementById('billing-form').submit();
    });

    function updateStaticPoojaPrice() {
    const poojaSelect = document.getElementById('pooja-select');
    const priceInput = document.getElementById('pooja-price');

    // Get the selected option
    const selectedOption = poojaSelect.options[poojaSelect.selectedIndex];
    const price = selectedOption.getAttribute('data-price');

    // Update the price input field
    if (price) {
        priceInput.value = price;
    }
}

</script>

{% endblock %}
